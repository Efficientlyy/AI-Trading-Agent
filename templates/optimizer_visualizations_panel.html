<!-- 
    Optimizer Visualizations Component
    
    This component provides visualizations to analyze strategy optimization processes and results,
    including optimization paths, parameter sensitivity analysis, performance surfaces,
    and optimization result comparisons.
-->

<div class="card optimizer-visualizations-panel">
    <div class="card-header">
        <div class="card-title">
            <h3>Optimizer Visualizations</h3>
            <div class="card-actions">
                <button id="optimizer-settings-btn" class="btn btn-icon" data-tooltip="Optimizer settings" data-position="top">
                    <i data-feather="settings"></i>
                </button>
                <button id="download-optimizer-data-btn" class="btn btn-icon" data-tooltip="Download data" data-position="top">
                    <i data-feather="download"></i>
                </button>
                <button id="expand-optimizer-panel-btn" class="btn btn-icon" data-tooltip="Expand panel" data-position="top">
                    <i data-feather="maximize-2"></i>
                </button>
            </div>
        </div>
        <div class="optimizer-controls">
            <div class="strategy-selector">
                <label for="optimizer-strategy">Strategy:</label>
                <select id="optimizer-strategy" class="form-select">
                    <option value="sentiment" selected>Sentiment Strategy</option>
                    <option value="ma_crossover">MA Crossover</option>
                    <option value="mean_reversion">Mean Reversion</option>
                    <option value="momentum">Momentum Strategy</option>
                    <option value="ml_prediction">ML Prediction</option>
                </select>
            </div>
            <div class="asset-selector">
                <label for="optimizer-asset">Asset:</label>
                <select id="optimizer-asset" class="form-select">
                    <option value="all">All Assets</option>
                    <option value="BTC-USD" selected>BTC/USD</option>
                    <option value="ETH-USD">ETH/USD</option>
                    <option value="SOL-USD">SOL/USD</option>
                    <option value="BNB-USD">BNB/USD</option>
                </select>
            </div>
            <div class="time-range-selector">
                <label for="optimizer-timerange">Optimization Period:</label>
                <select id="optimizer-timerange" class="form-select">
                    <option value="1w">1 Week</option>
                    <option value="1m">1 Month</option>
                    <option value="3m" selected>3 Months</option>
                    <option value="6m">6 Months</option>
                    <option value="1y">1 Year</option>
                </select>
            </div>
            <div class="optimization-run-selector">
                <label for="optimization-run">Optimizer Run:</label>
                <select id="optimization-run" class="form-select">
                    <option value="latest" selected>Latest Run</option>
                    <option value="run_20250315">March 15, 2025</option>
                    <option value="run_20250301">March 1, 2025</option>
                    <option value="run_20250215">February 15, 2025</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="card-body">
        <div class="optimizer-grid">
            <!-- Optimization Process Visualization -->
            <div class="optimizer-grid-item optimization-process-container">
                <h4 class="chart-title">Optimization Process</h4>
                <div class="visualization-controls">
                    <div class="process-view-selector">
                        <label for="process-view">View:</label>
                        <select id="process-view" class="form-select">
                            <option value="iterations" selected>Iterations</option>
                            <option value="convergence">Convergence Path</option>
                            <option value="population">Population Distribution</option>
                        </select>
                    </div>
                    <div class="metric-selector">
                        <label for="process-metric">Metric:</label>
                        <select id="process-metric" class="form-select">
                            <option value="sharpe" selected>Sharpe Ratio</option>
                            <option value="returns">Total Returns</option>
                            <option value="drawdown">Max Drawdown</option>
                            <option value="calmar">Calmar Ratio</option>
                        </select>
                    </div>
                </div>
                <div id="optimization-process-chart" class="optimizer-chart">
                    <div class="chart-overlay">Loading...</div>
                </div>
            </div>
            
            <!-- Parameter Sensitivity Analysis -->
            <div class="optimizer-grid-item parameter-sensitivity-container">
                <h4 class="chart-title">Parameter Sensitivity Analysis</h4>
                <div class="visualization-controls">
                    <div class="parameter-selector">
                        <label for="sensitivity-parameter">Parameter:</label>
                        <select id="sensitivity-parameter" class="form-select">
                            <option value="sentiment_threshold" selected>Sentiment Threshold</option>
                            <option value="position_size">Position Size</option>
                            <option value="exit_threshold">Exit Threshold</option>
                            <option value="lookback_period">Lookback Period</option>
                        </select>
                    </div>
                    <div class="sensitivity-view-selector">
                        <label for="sensitivity-view">View:</label>
                        <select id="sensitivity-view" class="form-select">
                            <option value="univariate" selected>Univariate</option>
                            <option value="bivariate">Bivariate</option>
                            <option value="contribution">Impact Contribution</option>
                        </select>
                    </div>
                </div>
                <div id="parameter-sensitivity-chart" class="optimizer-chart">
                    <div class="chart-overlay">Loading...</div>
                </div>
            </div>
            
            <!-- Performance Surface Visualization -->
            <div class="optimizer-grid-item performance-surface-container">
                <h4 class="chart-title">Performance Surface Visualization</h4>
                <div class="visualization-controls">
                    <div class="parameter-x-selector">
                        <label for="surface-param-x">X-Axis:</label>
                        <select id="surface-param-x" class="form-select">
                            <option value="sentiment_threshold" selected>Sentiment Threshold</option>
                            <option value="position_size">Position Size</option>
                            <option value="exit_threshold">Exit Threshold</option>
                            <option value="lookback_period">Lookback Period</option>
                        </select>
                    </div>
                    <div class="parameter-y-selector">
                        <label for="surface-param-y">Y-Axis:</label>
                        <select id="surface-param-y" class="form-select">
                            <option value="sentiment_threshold">Sentiment Threshold</option>
                            <option value="position_size" selected>Position Size</option>
                            <option value="exit_threshold">Exit Threshold</option>
                            <option value="lookback_period">Lookback Period</option>
                        </select>
                    </div>
                </div>
                <div id="performance-surface-chart" class="optimizer-chart">
                    <div class="chart-overlay">Loading...</div>
                </div>
            </div>
            
            <!-- Optimization Results Comparison -->
            <div class="optimizer-grid-item results-comparison-container">
                <h4 class="chart-title">Optimization Results Comparison</h4>
                <div class="visualization-controls">
                    <div class="results-view-selector">
                        <label for="results-view">View:</label>
                        <select id="results-view" class="form-select">
                            <option value="parameters" selected>Parameter Changes</option>
                            <option value="metrics">Performance Metrics</option>
                            <option value="robustness">Robustness Analysis</option>
                        </select>
                    </div>
                    <div class="compare-selector">
                        <label for="compare-with">Compare With:</label>
                        <select id="compare-with" class="form-select">
                            <option value="baseline" selected>Baseline</option>
                            <option value="previous">Previous Run</option>
                            <option value="best_historical">Best Historical</option>
                        </select>
                    </div>
                </div>
                <div id="results-comparison-chart" class="optimizer-chart">
                    <div class="chart-overlay">Loading...</div>
                </div>
            </div>
        </div>
        
        <div class="optimizer-insights">
            <div class="insight-card">
                <div class="insight-header">
                    <h4>Optimization Summary</h4>
                </div>
                <div class="insight-body">
                    <div class="optimization-summary">
                        <div class="summary-metrics">
                            <div class="metric-group">
                                <div class="metric-item">
                                    <span class="metric-label">Iterations:</span>
                                    <span class="metric-value" id="iterations-count">128</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Convergence:</span>
                                    <span class="metric-value" id="convergence-status">Achieved</span>
                                </div>
                            </div>
                            <div class="metric-group">
                                <div class="metric-item">
                                    <span class="metric-label">Performance Gain:</span>
                                    <span class="metric-value" id="performance-gain">+18.7%</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Sharpe Improvement:</span>
                                    <span class="metric-value" id="sharpe-improvement">+0.42</span>
                                </div>
                            </div>
                            <div class="metric-group">
                                <div class="metric-item">
                                    <span class="metric-label">Most Sensitive Param:</span>
                                    <span class="metric-value" id="sensitive-parameter">Sentiment Threshold</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">Optimal Value:</span>
                                    <span class="metric-value" id="optimal-value">0.65</span>
                                </div>
                            </div>
                        </div>
                        <div class="parameter-table">
                            <h5>Optimized Parameters</h5>
                            <table class="mini-table">
                                <thead>
                                    <tr>
                                        <th>Parameter</th>
                                        <th>Baseline</th>
                                        <th>Optimized</th>
                                        <th>Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Sentiment Threshold</td>
                                        <td>0.50</td>
                                        <td>0.65</td>
                                        <td class="positive">+0.15</td>
                                    </tr>
                                    <tr>
                                        <td>Position Size</td>
                                        <td>0.10</td>
                                        <td>0.15</td>
                                        <td class="positive">+0.05</td>
                                    </tr>
                                    <tr>
                                        <td>Exit Threshold</td>
                                        <td>-0.25</td>
                                        <td>-0.30</td>
                                        <td class="negative">-0.05</td>
                                    </tr>
                                    <tr>
                                        <td>Lookback Period</td>
                                        <td>14</td>
                                        <td>10</td>
                                        <td class="negative">-4</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <div class="insight-card">
                <div class="insight-header">
                    <h4>Optimization Insights</h4>
                </div>
                <div class="insight-body">
                    <div class="recommendations-list" id="optimizer-recommendations">
                        <div class="recommendation-item high-priority">
                            <div class="recommendation-header">
                                <span class="recommendation-title">Increase Sentiment Threshold in Volatile Markets</span>
                                <span class="recommendation-priority">High Impact</span>
                            </div>
                            <div class="recommendation-description">
                                Increasing the sentiment threshold from 0.50 to 0.65 improves Sharpe ratio by 28% during high volatility periods. This makes the strategy more conservative but significantly reduces drawdowns.
                            </div>
                        </div>
                        <div class="recommendation-item medium-priority">
                            <div class="recommendation-header">
                                <span class="recommendation-title">Reduce Lookback Period</span>
                                <span class="recommendation-priority">Medium Impact</span>
                            </div>
                            <div class="recommendation-description">
                                A shorter lookback period (10 days vs 14) improves responsiveness to market regime changes, resulting in 12% higher returns during trend reversals. Consider implementing adaptive lookback based on volatility.
                            </div>
                        </div>
                        <div class="recommendation-item low-priority">
                            <div class="recommendation-header">
                                <span class="recommendation-title">Optimize by Market Regime</span>
                                <span class="recommendation-priority">Low Impact</span>
                            </div>
                            <div class="recommendation-description">
                                Parameter optimization shows distinct optimal values in different market regimes. Consider implementing regime-specific parameter sets that automatically adjust based on detected market conditions.
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card-footer">
        <div class="optimizer-metrics-summary">
            <div class="metric-item">
                <span class="metric-label">Optimization Time:</span>
                <span class="metric-value" id="optimization-time">18 minutes</span>
            </div>
            <div class="metric-item">
                <span class="metric-label">Parameter Combinations:</span>
                <span class="metric-value" id="parameter-combinations">2,048</span>
            </div>
            <div class="metric-item">
                <span class="metric-label">Cross-Validation Score:</span>
                <span class="metric-value" id="cv-score">0.82</span>
            </div>
            <div class="metric-item">
                <span class="metric-label">Updated:</span>
                <span class="metric-value" id="optimizer-last-updated">3 days ago</span>
            </div>
        </div>
        <div class="optimizer-actions">
            <button class="btn btn-sm" id="optimizer-learn-more">
                <i data-feather="info"></i> Learn More
            </button>
            <button class="btn btn-sm" id="export-optimizer-report">
                <i data-feather="file-text"></i> Export Report
            </button>
        </div>
    </div>
</div>

<!-- Optimizer Settings Modal -->
<div id="optimizer-settings-modal" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Optimizer Settings</h3>
                <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="optimization-algorithm">Optimization Algorithm:</label>
                    <select id="optimization-algorithm" class="form-select">
                        <option value="genetic" selected>Genetic Algorithm</option>
                        <option value="bayesian">Bayesian Optimization</option>
                        <option value="grid">Grid Search</option>
                        <option value="random">Random Search</option>
                        <option value="particle_swarm">Particle Swarm</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="optimization-objective">Optimization Objective:</label>
                    <select id="optimization-objective" class="form-select">
                        <option value="sharpe" selected>Sharpe Ratio</option>
                        <option value="sortino">Sortino Ratio</option>
                        <option value="cagr">CAGR</option>
                        <option value="calmar">Calmar Ratio</option>
                        <option value="custom">Custom Objective</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="constraint-settings">Constraints:</label>
                    <div class="constraint-settings">
                        <div class="constraint-item">
                            <span class="constraint-label">Max Drawdown:</span>
                            <input type="text" id="max-drawdown-constraint" class="form-input constraint-input" value="30%">
                        </div>
                        <div class="constraint-item">
                            <span class="constraint-label">Min Win Rate:</span>
                            <input type="text" id="min-win-rate-constraint" class="form-input constraint-input" value="52%">
                        </div>
                        <div class="constraint-item">
                            <span class="constraint-label">Min Trades:</span>
                            <input type="text" id="min-trades-constraint" class="form-input constraint-input" value="50">
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="crossvalidation-settings">Cross-Validation:</label>
                    <div class="slider-container">
                        <span class="slider-label">Folds:</span>
                        <input type="range" id="cv-folds" class="form-range" min="2" max="10" value="5">
                        <span class="slider-value">5</span>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="time-series-cv" checked>
                        <label for="time-series-cv">Use Time-Series Cross-Validation</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="genetic-algorithm-settings">Genetic Algorithm Settings:</label>
                    <div class="slider-container">
                        <span class="slider-label">Population Size:</span>
                        <input type="range" id="population-size" class="form-range" min="20" max="200" step="10" value="100">
                        <span class="slider-value">100</span>
                    </div>
                    <div class="slider-container">
                        <span class="slider-label">Generations:</span>
                        <input type="range" id="generations" class="form-range" min="10" max="100" step="5" value="30">
                        <span class="slider-value">30</span>
                    </div>
                    <div class="slider-container">
                        <span class="slider-label">Mutation Rate:</span>
                        <input type="range" id="mutation-rate" class="form-range" min="0.01" max="0.5" step="0.01" value="0.1">
                        <span class="slider-value">0.1</span>
                    </div>
                </div>
                <div class="form-group">
                    <label>Advanced Options:</label>
                    <div class="checkbox-item">
                        <input type="checkbox" id="use-early-stopping" checked>
                        <label for="use-early-stopping">Enable Early Stopping</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="parallel-processing" checked>
                        <label for="parallel-processing">Use Parallel Processing</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="walk-forward-analysis">
                        <label for="walk-forward-analysis">Perform Walk-Forward Analysis</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="save-intermediate-results" checked>
                        <label for="save-intermediate-results">Save Intermediate Results</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="save-optimizer-settings">Apply Settings</button>
            </div>
        </div>
    </div>
</div>

<!-- Add CSS for the optimizer visualizations panel -->
<style>
    .optimizer-visualizations-panel {
        margin-bottom: 1.5rem;
    }
    
    .optimizer-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: center;
        margin-top: 0.75rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border-light);
    }
    
    .strategy-selector,
    .asset-selector,
    .time-range-selector,
    .optimization-run-selector {
        min-width: 150px;
    }
    
    .optimizer-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        grid-template-rows: 300px 300px;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .optimizer-grid-item {
        background-color: var(--bg-light);
        border-radius: 6px;
        overflow: hidden;
        position: relative;
        padding: 0.5rem;
        display: flex;
        flex-direction: column;
    }
    
    .chart-title {
        font-size: 0.9rem;
        font-weight: 500;
        color: var(--text);
        margin: 0 0 0.5rem 0;
        padding: 0 0 0.5rem 0;
        border-bottom: 1px solid var(--border-light);
    }
    
    .optimizer-chart {
        flex: 1;
        position: relative;
        min-height: 200px;
        background-color: var(--card-bg);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .chart-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(var(--card-bg-rgb), 0.8);
        font-size: 1rem;
        color: var(--text-light);
        z-index: 5;
    }
    
    .visualization-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
        align-items: center;
        justify-content: space-between;
    }
    
    .process-view-selector,
    .metric-selector,
    .parameter-selector,
    .sensitivity-view-selector,
    .parameter-x-selector,
    .parameter-y-selector,
    .results-view-selector,
    .compare-selector {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .visualization-controls label {
        font-size: 0.8rem;
        color: var(--text-light);
    }
    
    .visualization-controls select {
        max-width: 120px;
        font-size: 0.8rem;
    }
    
    .optimizer-insights {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .insight-card {
        background-color: var(--bg-light);
        border-radius: 6px;
        overflow: hidden;
    }
    
    .insight-header {
        padding: 0.75rem 1rem;
        border-bottom: 1px solid var(--border-light);
    }
    
    .insight-header h4 {
        margin: 0;
        font-size: 0.9rem;
        font-weight: 500;
    }
    
    .insight-body {
        padding: 0.75rem 1rem;
    }
    
    .optimization-summary {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }
    
    .summary-metrics {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
    }
    
    .metric-group {
        flex: 1;
        min-width: 150px;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .metric-item {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
    }
    
    .metric-label {
        color: var(--text-light);
    }
    
    .metric-value {
        font-weight: 500;
    }
    
    .parameter-table {
        margin-top: 0.5rem;
    }
    
    .parameter-table h5 {
        font-size: 0.85rem;
        margin: 0 0 0.5rem 0;
        color: var(--text-light);
    }
    
    .mini-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.8rem;
    }
    
    .mini-table th,
    .mini-table td {
        padding: 0.4rem;
        text-align: left;
        border-bottom: 1px solid var(--border-light);
    }
    
    .mini-table th {
        font-weight: 500;
        color: var(--text-light);
    }
    
    .mini-table td.positive {
        color: var(--success);
    }
    
    .mini-table td.negative {
        color: var(--danger);
    }
    
    .recommendations-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .recommendation-item {
        padding: 0.75rem;
        border-radius: 4px;
        border-left: 3px solid var(--primary);
        background-color: var(--card-bg);
    }
    
    .recommendation-item.high-priority {
        border-left-color: var(--danger);
    }
    
    .recommendation-item.medium-priority {
        border-left-color: var(--warning);
    }
    
    .recommendation-item.low-priority {
        border-left-color: var(--info);
    }
    
    .recommendation-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.5rem;
    }
    
    .recommendation-title {
        font-weight: 500;
        font-size: 0.85rem;
    }
    
    .recommendation-priority {
        font-size: 0.75rem;
        padding: 0.2rem 0.4rem;
        border-radius: 3px;
        background-color: var(--primary-light);
        color: var(--primary);
    }
    
    .high-priority .recommendation-priority {
        background-color: rgba(var(--danger-rgb), 0.1);
        color: var(--danger);
    }
    
    .medium-priority .recommendation-priority {
        background-color: rgba(var(--warning-rgb), 0.1);
        color: var(--warning);
    }
    
    .low-priority .recommendation-priority {
        background-color: rgba(var(--info-rgb), 0.1);
        color: var(--info);
    }
    
    .recommendation-description {
        font-size: 0.8rem;
        color: var(--text-light);
        line-height: 1.4;
    }
    
    .optimizer-metrics-summary {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
    }
    
    .optimizer-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    /* Modal specific styles */
    .constraint-settings {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        margin-top: 0.5rem;
    }
    
    .constraint-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .constraint-label {
        min-width: 100px;
        font-size: 0.85rem;
    }
    
    .constraint-input {
        width: 100%;
        padding: 0.25rem;
        border: 1px solid var(--border-light);
        border-radius: 4px;
        font-size: 0.85rem;
    }
    
    .slider-container {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .slider-label {
        min-width: 100px;
        font-size: 0.85rem;
    }
    
    .form-range {
        flex: 1;
    }
    
    .slider-value {
        min-width: 1.5rem;
        text-align: right;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .checkbox-item label {
        font-size: 0.85rem;
        margin: 0;
    }
    
    /* Responsive adjustments */
    @media (max-width: 992px) {
        .optimizer-grid {
            grid-template-columns: 1fr;
            grid-template-rows: repeat(4, 300px);
        }
        
        .optimizer-insights {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 768px) {
        .optimizer-controls {
            flex-direction: column;
            align-items: stretch;
        }
        
        .strategy-selector,
        .asset-selector,
        .time-range-selector,
        .optimization-run-selector {
            width: 100%;
        }
        
        .optimizer-metrics-summary {
            flex-direction: column;
            gap: 0.75rem;
        }
        
        .summary-metrics {
            flex-direction: column;
        }
    }
</style>

<!-- JavaScript for optimizer visualizations panel functionality will be loaded separately -->