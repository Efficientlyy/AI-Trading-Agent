<!-- 
    Risk-Adjusted Performance Metrics Panel Component
    
    This component displays risk-adjusted performance metrics including
    Sharpe/Sortino ratio evolution, Calmar ratio, and risk/reward optimization.
-->

<div class="card risk-performance-panel">
    <div class="card-header">
        <div class="card-title">
            <h3>Risk-Adjusted Performance Metrics</h3>
            <div class="card-actions">
                <button id="refresh-metrics-btn" class="btn btn-icon" data-tooltip="Refresh metrics" data-position="top">
                    <i data-feather="refresh-cw"></i>
                </button>
                <button id="expand-metrics-panel-btn" class="btn btn-icon" data-tooltip="Expand panel" data-position="top">
                    <i data-feather="maximize-2"></i>
                </button>
            </div>
        </div>
        <div class="metrics-controls">
            <div class="time-range-selector">
                <label for="metrics-time-range">Time Range:</label>
                <select id="metrics-time-range" class="form-select">
                    <option value="1m">1 Month</option>
                    <option value="3m">3 Months</option>
                    <option value="6m">6 Months</option>
                    <option value="1y" selected>1 Year</option>
                    <option value="2y">2 Years</option>
                    <option value="all">All Time</option>
                </select>
            </div>
            <div class="strategy-selector">
                <label for="metrics-strategy">Strategy:</label>
                <select id="metrics-strategy" class="form-select">
                    <option value="ma-crossover" selected>MA Crossover</option>
                    <option value="sentiment">Sentiment-based</option>
                    <option value="ml-strategy">Machine Learning</option>
                    <option value="combined">Combined Strategy</option>
                </select>
            </div>
            <div class="metric-type-selector">
                <label for="metric-type">Metric Type:</label>
                <select id="metric-type" class="form-select">
                    <option value="sharpe" selected>Sharpe Ratio</option>
                    <option value="sortino">Sortino Ratio</option>
                    <option value="calmar">Calmar Ratio</option>
                    <option value="omega">Omega Ratio</option>
                    <option value="mar">MAR Ratio</option>
                </select>
            </div>
        </div>
    </div>
    
    <div class="card-body">
        <div class="metrics-dashboard">
            <div class="metric-overview">
                <div class="metric-cards">
                    <div class="metric-card">
                        <div class="metric-header">Sharpe Ratio</div>
                        <div class="metric-value" id="sharpe-value">1.87</div>
                        <div class="metric-trend positive">+0.23 <i data-feather="trending-up" class="trend-icon"></i></div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header">Sortino Ratio</div>
                        <div class="metric-value" id="sortino-value">2.14</div>
                        <div class="metric-trend positive">+0.32 <i data-feather="trending-up" class="trend-icon"></i></div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header">Calmar Ratio</div>
                        <div class="metric-value" id="calmar-value">1.52</div>
                        <div class="metric-trend negative">-0.18 <i data-feather="trending-down" class="trend-icon"></i></div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-header">MAR Ratio</div>
                        <div class="metric-value" id="mar-value">1.68</div>
                        <div class="metric-trend positive">+0.15 <i data-feather="trending-up" class="trend-icon"></i></div>
                    </div>
                </div>
            </div>
            
            <div class="ratio-evolution-chart">
                <h4>Ratio Evolution Over Time</h4>
                <div id="ratio-evolution-chart" class="chart-container">
                    <div class="chart-overlay">Loading...</div>
                </div>
            </div>
            
            <div class="metrics-detailed-analysis">
                <div class="metrics-analysis-section">
                    <h4>Risk-Return Analysis</h4>
                    <div class="analysis-cards">
                        <div class="metrics-cols">
                            <div class="metrics-col">
                                <div id="risk-reward-chart" class="chart-container-sm">
                                    <div class="chart-overlay">Loading...</div>
                                </div>
                            </div>
                            <div class="metrics-col">
                                <div id="drawdown-analysis-chart" class="chart-container-sm">
                                    <div class="chart-overlay">Loading...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="metrics-analysis-section">
                    <h4>Optimization Surface</h4>
                    <div class="optimization-visualization">
                        <div id="optimization-surface-chart" class="chart-container-md">
                            <div class="chart-overlay">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="card-footer">
        <div class="metrics-summary">
            <div class="summary-item">
                <span class="summary-label">Avg. Return:</span>
                <span class="summary-value positive">18.7%</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Max Drawdown:</span>
                <span class="summary-value negative">-12.3%</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Risk Tolerance:</span>
                <span class="summary-value">Medium</span>
            </div>
            <div class="summary-item">
                <span class="summary-label">Overall Rating:</span>
                <span class="summary-value">
                    <span class="rating-stars">★★★★☆</span>
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Add CSS for the risk performance metrics panel -->
<style>
    .risk-performance-panel {
        margin-bottom: 1.5rem;
    }
    
    .metrics-controls {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        align-items: center;
        margin-top: 0.75rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border-light);
    }
    
    .time-range-selector,
    .strategy-selector,
    .metric-type-selector {
        min-width: 150px;
    }
    
    .metrics-dashboard {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }
    
    .metric-overview {
        width: 100%;
    }
    
    .metric-cards {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .metric-card {
        flex: 1;
        min-width: 200px;
        background-color: var(--bg-light);
        border-radius: 8px;
        padding: 1.25rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    
    .metric-header {
        font-size: 0.9rem;
        color: var(--text-light);
        margin-bottom: 0.5rem;
        font-weight: 500;
    }
    
    .metric-value {
        font-size: 1.75rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text);
    }
    
    .metric-trend {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    .metric-trend.positive {
        color: var(--success);
    }
    
    .metric-trend.negative {
        color: var(--danger);
    }
    
    .trend-icon {
        width: 14px;
        height: 14px;
    }
    
    .ratio-evolution-chart {
        width: 100%;
    }
    
    .ratio-evolution-chart h4 {
        margin-bottom: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
    }
    
    .chart-container {
        width: 100%;
        height: 300px;
        position: relative;
        background-color: var(--card-bg);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .metrics-detailed-analysis {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-top: 1rem;
    }
    
    .metrics-analysis-section h4 {
        margin-bottom: 0.75rem;
        font-size: 1rem;
        font-weight: 600;
    }
    
    .metrics-cols {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
    }
    
    .metrics-col {
        flex: 1;
        min-width: 300px;
    }
    
    .chart-container-sm {
        width: 100%;
        height: 220px;
        position: relative;
        background-color: var(--card-bg);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .chart-container-md {
        width: 100%;
        height: 350px;
        position: relative;
        background-color: var(--card-bg);
        border-radius: 4px;
        overflow: hidden;
    }
    
    .chart-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: rgba(var(--card-bg-rgb), 0.8);
        font-size: 1rem;
        color: var(--text-light);
    }
    
    .metrics-summary {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        align-items: center;
    }
    
    .summary-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .summary-label {
        font-size: 0.9rem;
        color: var(--text-light);
        font-weight: 500;
    }
    
    .summary-value {
        font-size: 0.9rem;
        font-weight: 600;
    }
    
    .summary-value.positive {
        color: var(--success);
    }
    
    .summary-value.negative {
        color: var(--danger);
    }
    
    .rating-stars {
        color: var(--warning);
        letter-spacing: 2px;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .metrics-controls {
            flex-direction: column;
            align-items: flex-start;
            gap: 0.75rem;
        }
        
        .time-range-selector,
        .strategy-selector,
        .metric-type-selector {
            width: 100%;
        }
        
        .metric-card {
            min-width: 100%;
            margin-bottom: 0.75rem;
        }
        
        .chart-container {
            height: 250px;
        }
        
        .metrics-col {
            min-width: 100%;
        }
    }
</style>

<!-- JavaScript for risk performance metrics panel functionality -->
<script src="{{ url_for('static', filename='js/risk_performance_metrics.js') }}"></script>